<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í‹°ì¼“íŒ… ì„œë¹„ìŠ¤</title>
    <style>
        /* ê°„ë‹¨í•œ ìŠ¤íƒ€ì¼ë§ */
        body { background-color: #fff; color: #333; padding: 20px; font-family: sans-serif; }
        .event-card { border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 8px; }
        .status-open { color: green; font-weight: bold; }
        .status-wait { color: orange; font-weight: bold; }
        input, textarea { display: block; margin-bottom: 10px; width: 300px; padding: 5px; }
    </style>
</head>
<body>
    <nav style="margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
        <% if (isLoggedIn) { %>
            <span>ğŸ‘‹ í™˜ì˜í•©ë‹ˆë‹¤, <strong><%= user.nickname %></strong>ë‹˜!</span>
            <a href="/auth/logout" style="margin-left: 10px;">ë¡œê·¸ì•„ì›ƒ</a>
        <% } else { %>
            <a href="/auth/login">ë¡œê·¸ì¸</a> | 
            <a href="/auth/register">íšŒì›ê°€ì…</a>
        <% } %>
    </nav>

    <h1>ğŸ« í‹°ì¼“íŒ… ë©”ì¸ í˜ì´ì§€</h1>

    <section>
        <h2>ê³µì—° ëª©ë¡</h2>
        <% if (events && events.length > 0) { %>
            <% events.forEach(event => { %>
                <div class="event-card">
                    <h3><%= event.title %></h3>
                    <p><%= event.description %></p>
                    <p>ì˜¤í”ˆ ì‹œê°„: <strong><%= new Date(event.openAt).toLocaleString() %></strong></p>
                    
                    <% const isOpen = new Date() >= new Date(event.openAt); %>
                    
                    <% if (isOpen) { %>
                        <button class="status-open">ì˜ˆë§¤í•˜ê¸°</button>
                    <% } else { %>
                        <button disabled>ì˜¤í”ˆ ëŒ€ê¸°ì¤‘</button>
                    <% } %>
                </div>
            <% }); %>
        <% } else { %>
            <p>ë“±ë¡ëœ ê³µì—°ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        <% } %>
    </section>

    <hr style="margin: 30px 0;">

    <% if (isLoggedIn) { %>
        <section style="background-color: #f9f9f9; padding: 20px; border-radius: 10px;">
            <h2>â• ìƒˆ ê³µì—° ë§Œë“¤ê¸° (ê´€ë¦¬ììš©)</h2>
            <form id="createEventForm">
                <label>ê³µì—° ì œëª©</label>
                <input type="text" name="title" placeholder="ì˜ˆ: ì„ì˜ì›… ì½˜ì„œíŠ¸" required>
                
                <label>ê³µì—° ì„¤ëª…</label>
                <textarea name="description" placeholder="ì„¤ëª… ì…ë ¥"></textarea>
                
                <label>ì˜¤í”ˆ ì‹œê°„</label>
                <input type="datetime-local" name="openAt" required>

                <button type="submit">ê³µì—° ìƒì„±í•˜ê¸°</button>
            </form>
        </section>

        <script>
            document.getElementById('createEventForm').addEventListener('submit', async (e) => {
                e.preventDefault(); // í™”ë©´ ìƒˆë¡œê³ ì¹¨ ë°©ì§€

                const formData = new FormData(e.target);
                const data = {
                    title: formData.get('title'),
                    description: formData.get('description'),
                    // ISO String ë³€í™˜ (NestJS DTOê°€ DateStringì„ ì›í•¨)
                    openAt: new Date(formData.get('openAt')).toISOString(),
                };

                try {
                    const response = await fetch('/events', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });

                    if (response.ok) {
                        alert('ê³µì—°ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
                        window.location.reload(); // ëª©ë¡ ê°±ì‹ ì„ ìœ„í•´ ìƒˆë¡œê³ ì¹¨
                    } else {
                        const err = await response.json();
                        alert('ìƒì„± ì‹¤íŒ¨: ' + JSON.stringify(err));
                    }
                } catch (error) {
                    console.error(error);
                    alert('ì„œë²„ ì˜¤ë¥˜ ë°œìƒ');
                }
            });
        </script>
    <% } %>

</body>
</html>